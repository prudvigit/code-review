@AbapCatalog.sqlViewName: 'ZV_EARLIEST_DEMAND'
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #CHECK
@EndUserText.label: 'Earliest Demand'
define view ZCV_P2M_EARLIEST_DEMAND 
  as select from (
  
    select 
      vbbe.matnr            as Material,
      vbbe.werks            as Plant,
      vbbe.mbdat            as DemandDate
    from vbbe
    where vbbe.mbdat is not null

    union all

    select 
      resb.matnr            as Material,
      resb.werks            as Plant,
      resb.bdter            as DemandDate
    from resb
    where resb.bdter is not null

    union all

    select 
      mdpb.matnr            as Material,
      mdpb.werks            as Plant,
      mdpb.pdatu            as DemandDate
    from mdpb
    where mdpb.pdatu is not null

  ) as DemandUnion

{
  Material,
  Plant,
  min(DemandDate) as EarliestDemandDate
}
group by
  Material,
  Plant    
}
