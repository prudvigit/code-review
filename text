  // Bulk material rule: X if type = ZPRR
  case
    when mara.mtart = 'ZPRR' then 'X'
    else ''
  end as schgt_rule,                                 // Rule: BulkIndicator by MaterialType

  // Bulk error: if BulkIndicator manually X but type <> ZPRR
  case
    when marc_comp.schgt = 'X' and mara.mtart <> 'ZPRR'
      then 'Error: BULK'
    else ''
  end as bulk_error,                                // Error if inconsistent bulk setting

  // Backflush Rule Logic
  case
    when marc_header.sfcpf = 'Z00001' and mara.xchpf <> 'X' then 'X'
    else ''
  end as backflush_check,                            // Rule: Backflush allowed

  case
    when marc_header.sfcpf = 'Z00001' and mara.xchpf = 'X' then 'Error: BACKFLUSH'
    else ''
  end as backflush_error                             // Error if batch managed and schedule profile = Z00001
